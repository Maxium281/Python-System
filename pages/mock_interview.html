<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>模拟面试 - Python面试题学习系统</title>
    <!-- 本地资源引入 -->
    <link rel="stylesheet" href="../static/icons/font-awesome.min.css" />
    <link rel="stylesheet" href="../static/css/custom.css" />
  </head>
  <body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="index.html">Python面试题系统</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="index.html">首页</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="question_category.html">题库分类</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="mock_interview.html">模拟面试</a>
            </li>
            <li class="nav-item"><a class="nav-link" href="#">我的进度</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- 主体内容 -->
    <div class="container mt-4">
      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">模拟面试（共10题，30分钟）</h5>
          <span class="badge bg-danger" id="interviewCountdown">30:00</span>
        </div>
        <div class="card-body">
          <form id="interviewForm">
            <div id="mockQuestionList">
              <!-- 模拟面试题目由JS动态生成 -->
            </div>
            <button type="submit" class="btn btn-primary">提交所有答案</button>
            <button type="button" class="btn btn-danger ms-2" id="giveUpBtn">
              放弃面试
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- 页脚 -->
    <footer class="mt-5 py-3 bg-light text-center">
      <p>© 2024 Python面试题学习系统（单机版）| 无需联网，本地运行</p>
    </footer>

    <!-- 本地JS引入 -->
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script>
      // 模拟10道面试题
      const mockInterviewQuestions = [
        {
          id: 1,
          title: "Python中列表和元组的区别是什么？",
          type: "single",
          options: [
            { key: "A", content: "列表是不可变的，元组是可变的" },
            { key: "B", content: "列表是可变的，元组是不可变的" },
            { key: "C", content: "列表和元组都不可变" },
            { key: "D", content: "列表和元组都可变" },
          ],
        },
        {
          id: 2,
          title: "什么是Python的装饰器？请举例说明",
          type: "single",
          options: [
            { key: "A", content: "装饰器是一种用于修改函数功能的语法糖" },
            { key: "B", content: "装饰器是一种数据类型" },
            { key: "C", content: "装饰器用于定义类" },
            { key: "D", content: "装饰器用于异常处理" },
          ],
        },
        {
          id: 101,
          title: "Flask和Django的区别有哪些？",
          type: "multiple",
          options: [
            { key: "A", content: "Flask是轻量级框架，Django是全栈框架" },
            { key: "B", content: "Django内置ORM，Flask需要第三方扩展" },
            { key: "C", content: "Flask性能比Django高10倍" },
            { key: "D", content: "Django适合大型项目，Flask适合小型项目" },
          ],
        },
        {
          id: 201,
          title: "你在项目中如何优化Python程序的性能？",
          type: "multiple",
          options: [
            { key: "A", content: "使用生成器代替列表推导式" },
            { key: "B", content: "减少全局变量的使用" },
            { key: "C", content: "使用多线程处理IO密集型任务" },
            { key: "D", content: "对频繁访问的数据进行缓存" },
          ],
        },
        {
          id: 3,
          title: "Python中的垃圾回收机制是怎样的？",
          type: "single",
          options: [
            { key: "A", content: "仅使用引用计数机制" },
            { key: "B", content: "引用计数+标记清除+分代回收" },
            { key: "C", content: "仅使用标记清除机制" },
            { key: "D", content: "手动回收内存" },
          ],
        },
        {
          id: 4,
          title: "Python中is和==的区别？",
          type: "single",
          options: [
            { key: "A", content: "is判断值相等，==判断内存地址相等" },
            { key: "B", content: "is判断内存地址相等，==判断值相等" },
            { key: "C", content: "is和==功能完全一致" },
            { key: "D", content: "is用于字符串比较，==用于数字比较" },
          ],
        },
        {
          id: 102,
          title: "Django的MTV架构分别对应什么？",
          type: "single",
          options: [
            { key: "A", content: "Model-View-Template" },
            { key: "B", content: "Model-Template-View" },
            { key: "C", content: "View-Model-Template" },
            { key: "D", content: "Template-Model-View" },
          ],
        },
        {
          id: 202,
          title: "项目中遇到过数据库性能瓶颈，你是如何解决的？",
          type: "multiple",
          options: [
            { key: "A", content: "添加合适的索引" },
            { key: "B", content: "优化SQL查询语句，避免联表查询" },
            { key: "C", content: "使用读写分离" },
            { key: "D", content: "对大表进行分库分表" },
          ],
        },
        {
          id: 5,
          title: "如何实现Python的单例模式？",
          type: "single",
          options: [
            { key: "A", content: "仅使用装饰器实现" },
            { key: "B", content: "仅使用类方法实现" },
            { key: "C", content: "装饰器、类方法、元类均可实现" },
            { key: "D", content: "Python不支持单例模式" },
          ],
        },
        {
          id: 203,
          title: "如何保证项目代码的可维护性？",
          type: "multiple",
          options: [
            { key: "A", content: "遵循代码规范（如PEP8）" },
            { key: "B", content: "编写详细的文档和注释" },
            { key: "C", content: "进行单元测试和集成测试" },
            { key: "D", content: "模块化开发，降低代码耦合度" },
          ],
        },
      ];

      // 渲染模拟面试题目
      function renderMockQuestions() {
        const questionListEl = document.getElementById("mockQuestionList");
        let html = "";
        mockInterviewQuestions.forEach((question, index) => {
          html += `
                <div class="mb-5">
                    <h6>${index + 1}. ${question.title}</h6>
                    <p class="text-muted">${
                      question.type === "single" ? "单选题" : "多选题"
                    }</p>
                    <div class="list-group">
                `;
          question.options.forEach((option) => {
            html += `
                        <label class="list-group-item">
                            <input class="form-check-input me-2" type="${
                              question.type === "single" ? "radio" : "checkbox"
                            }" 
                                   name="answer_${question.id}" value="${
              option.key
            }">
                            ${option.key}. ${option.content}
                        </label>
                    `;
          });
          html += `
                    </div>
                </div>
                `;
        });
        questionListEl.innerHTML = html;
      }

      // 面试倒计时
      function initInterviewCountdown() {
        let interviewTimeLeft = 30 * 60;
        const countdownEl = document.getElementById("interviewCountdown");
        const countdownInterval = setInterval(() => {
          const minutes = Math.floor(interviewTimeLeft / 60);
          const seconds = interviewTimeLeft % 60;
          countdownEl.textContent = `${minutes
            .toString()
            .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

          if (interviewTimeLeft <= 0) {
            clearInterval(countdownInterval);
            alert("面试时间结束！自动提交答案");
            document.getElementById("interviewForm").submit();
          }
          interviewTimeLeft--;
        }, 1000);
      }

      // 模拟提交面试答案
      document
        .getElementById("interviewForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const formData = new FormData(this);
          const selectedCount = document.querySelectorAll(
            'input[type="radio"]:checked, input[type="checkbox"]:checked'
          ).length;

          if (selectedCount === 0) {
            alert("请至少选择一道题的答案后提交！");
            return;
          }

          // 模拟统计正确率
          const correctAnswers = {
            1: "B",
            2: "A",
            101: "ABD",
            201: "ABCD",
            3: "B",
            4: "B",
            102: "A",
            202: "ABCD",
            5: "C",
            203: "ABCD",
          };
          let correctCount = 0;
          let answeredCount = 0;

          for (const [qid, correctAns] of Object.entries(correctAnswers)) {
            const selectedOptions = document.querySelectorAll(
              `input[name="answer_${qid}"]:checked`
            );
            if (selectedOptions.length === 0) continue;

            answeredCount++;
            const userAns = Array.from(selectedOptions)
              .map((option) => option.value)
              .join("");
            if (userAns === correctAns) {
              correctCount++;
            }
          }

          const correctRate =
            answeredCount > 0
              ? Math.round((correctCount / answeredCount) * 100)
              : 0;
          alert(
            `面试提交成功！\n已答题：${answeredCount}/10道\n正确率：${correctRate}%\n（静态预览，成绩未真实存储）`
          );
          window.location.href = "index.html";
        });

      // 放弃面试
      document
        .getElementById("giveUpBtn")
        .addEventListener("click", function () {
          if (confirm("确定要放弃面试吗？已答题记录将不保存")) {
            window.location.href = "index.html";
          }
        });

      // 页面加载初始化
      window.onload = function () {
        renderMockQuestions();
        initInterviewCountdown();
      };
    </script>
  </body>
</html>
